<div ng-if="!feature_flags.new_client_note_flag">
  <notes-form ng-model="case.notes" case="case"></notes-form>

  <div ng-if="eligibility_check.notes">
    <figure class="CommentBlock Icon Icon--row Icon--comments">
      <cite class="CommentBlock-author">User said</cite>
      <blockquote class="Quote" ng-bind-html="eligibility_check.notes|escapeHtml|nl2br"></blockquote>
    </figure>
  </div>

  <div ng-if="case.provider_notes">
    <figure class="CommentBlock Icon Icon--row Icon--comments">
      <a href="" notes-history="{{ case.reference }}" history-type="cla_provider" summary="true" class="CommentBlock-history" title="View notes history"></a>
      <cite class="CommentBlock-author">Specialist provider said</cite>
      <blockquote class="Quote" ng-bind-html="::case.provider_notes|escapeHtml|nl2br"></blockquote>
    </figure>
  </div>
</div>


<div ng-if="feature_flags.new_client_note_flag">
  <!-- Old comment format used for cases pre-April 2025 -->
  <div ng-if="eligibility_check.notes">
      <figure class="CommentBlock">
        <cite class="CommentBlock-heading">Client problem</cite>
        <div class="CommentBlock-details">Details from version of '<a href="https://www.gov.uk/check-legal-aid" target="_blank">Check if you can get legal aid</a>' before 16 April 2025.</div>
        <cite class="CommentBlock-author">User said</cite>
        <blockquote class="Quote" ng-bind-html="eligibility_check.notes|escapeHtml|nl2br"></blockquote>
      </figure>
  </div>

  <!-- New comment format -->
  <div ng-if="case.scope_traversal">
    <p style="margin-bottom: 0;"><b>Client problem</b></p>
    <p style="margin-top: 0;">From <a href="https://www.gov.uk/check-legal-aid" target="_blank">'Check if you can get legal aid'</a></p>
    <p style="margin-bottom: 0;"><b>{{ scope_traversal.category.name | capitalizeFirst }}</b></p>
    <div ng-if="scope_traversal.subcategory">
       <p style="margin-bottom: 0; margin-top: 0;">{{ scope_traversal.subcategory.name }}</p>
       <p style="margin-top: 0">{{ scope_traversal.subcategory.description }}</p>
    </div>
    <div ng-if="scope_traversal.scope_answers.length > 1">
        <div ng-repeat="answer in scope_traversal.scope_answers">
          <div ng-if="answer.type == 'onward'">
            <p style="margin-bottom: 0;">{{ answer.question }}</p>
            <p style="margin-top: 0;">{{ answer.answer }}</p>
          </div>
        </div>
    </div>
    <div ng-if="case.client_notes">
        <p style="margin-bottom: 0;">Client notes</p>
        <p style="margin-top: 0;">"{{ case.client_notes }}"</p>
    </div>

    <div ng-if="scope_traversal.financial_assessment_status">
      <p style="margin-bottom: 0;">Financial assessment</p>
      <p style="margin-top: 0;">{{ scope_traversal.financial_assessment_status }}</p>
    </div>

    <div ng-if="scope_traversal.category.code">
      <p style="margin-bottom: 0;">Area of law</p>
      <p style="margin-top: 0;">{{ scope_traversal.category.code | capitalizeFirst }}</p>
    </div>

  </div>

  <notes-form ng-model="case.notes" case="case"></notes-form>

  <div ng-if="case.provider_notes">
    <figure class="CommentBlock">
      <a href="" notes-history="{{ case.reference }}" history-type="cla_provider" summary="true" class="CommentBlock-history" title="View notes history"></a>
      <cite class="CommentBlock-heading">Specialist provider notes</cite>
      <p class="CommentText" ng-bind-html="::case.provider_notes|escapeHtml|nl2br"></p>
    </figure>
  </div>
</div>
