# Lint Workflow Documentation
#  GitHub Actions workflow for running linting checks on the cla_frontend repository.
#
#  Purpose:
#    - Executes automated code quality and style checks on pull requests
#    - Runs Python linting using flake8 to maintain code standards
#
#  Triggers:
#    - Activates on all pull requests across any branch
#
#  Jobs:
#    - setup: Initializes workflow environment variables and outputs them for dependent jobs
#    - lint: Executes commit checks and Python-based linting checks using flake8 in a Python 2.7.18 container
#
#  Key Features:
#    - Minimal permissions set (contents: read only for Python job)
#    - Uses environment variables for timezone and environment configuration
#    -  Runs ministryofjustice/devsecops-actions/github/commit for commit validation
#    - Runs flake8 with exit-zero flag to report violations without failing the workflow
#    - Depends on setup job for environment output propagation
#
#  Requirements:
#    - ministryofjustice/devsecops-actions/github/commit
#    - Python linting dependencies installed from requirements/generated/requirements-lint.txt

name: Lint
run-name: Lint checks

on:
  pull_request:
    branches: ["**"]

permissions: {}

env:
  environment: base
  timezone: ${{ vars.TIMEZONE }}

jobs:
  setup:
    name: Setup
    runs-on: ["ubuntu-latest"]
    outputs:
      environment: ${{ env.environment }}
      timezone: ${{ env.timezone }}
    steps:
      - name: Environment
        run: echo "Environment set to ${{ env.environment }}"

      - name: Timezone
        run: echo "Timezone set to ${{ env.timezone }}"

  lint:
    permissions:
      contents: read

    name: Python
    runs-on: ["ubuntu-latest"]
    container:
      image: python:2.7.18-slim
    needs: [setup]
    environment:
      name: ${{ needs.setup.outputs.environment }}

    steps:
      - name: Repository
        uses: actions/checkout@8e8c483db84b4bee98b60c0593521ed34d9990e8 # v6.0.1

      - name: Commit
        uses: ministryofjustice/devsecops-actions/github/commit@27614b1ca989dade166b707a08f42a61b289a1ba # v1.3.0

      - name: Requirements
        shell: bash
        working-directory: ./
        run: python -m pip install -r requirements/generated/requirements-lint.txt

      - name: Lint
        shell: bash
        working-directory: ./
        run: python -m flake8 --exit-zero cla_frontend
